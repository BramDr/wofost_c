#include <stdio.h>#include <string.h>#include <stdlib.h>#include <limits.h>#include <netcdf.h>#include <math.h>#include "wofost.h"#include "extern.h"/* Handle errors by printing an error message and exiting with a * non-zero status. */#define ERR(e) {printf("Error: %s\n", nc_strerror(e)); exit(2);}void GetDomainData(char *domainfile){    size_t j, k;        int retval;    int ncid, lat_dimid, lon_dimid;    int lat_varid, lon_varid, varid;        size_t lat_length, lon_length;    float *data;        // get mask    // open file    if ((retval = nc_open(domainfile, NC_NOWRITE, &ncid)))        ERR(retval);        // get lat & lon    if ((retval = nc_inq_dimid(ncid, "lat", &lat_dimid)))        ERR(retval);    if ((retval = nc_inq_dimid(ncid, "lon", &lon_dimid)))        ERR(retval);    if ((retval = nc_inq_dimlen(ncid, lat_dimid, &lat_length)))       ERR(retval);     if ((retval = nc_inq_dimlen(ncid, lon_dimid, &lon_length)))       ERR(retval);    if (lat_length > DOMAIN_LENGTH) {        fprintf(stderr, "Latitude domain %zu is bigger than maximum %d\n",                 lat_length, DOMAIN_LENGTH);        exit(0);     }    if (lon_length > DOMAIN_LENGTH) {        fprintf(stderr, "Longitude domain %zu is bigger than maximum %d\n",                 lon_length, DOMAIN_LENGTH);        exit(0);     }    NLatitude = lat_length;    NLongitude = lon_length;    if ((retval = nc_inq_varid(ncid, "lat", &lat_varid)))        ERR(retval);    if ((retval = nc_inq_varid(ncid, "lon", &lon_varid)))        ERR(retval);    if ((retval = nc_get_var_double(ncid, lat_varid, &Latitude[0])))       ERR(retval);    if ((retval = nc_get_var_double(ncid, lon_varid, &Longitude[0])))       ERR(retval);        // allocate mask    Mask = malloc(NLongitude * sizeof(*Mask));    if(Mask == NULL){        fprintf(stderr, "Could not malloc");        exit(0);     }    for (j = 0; j < NLongitude; j++) {        Mask[j] = malloc(NLatitude * sizeof(*Mask[j]));        if(Mask == NULL){            fprintf(stderr, "Could not malloc");            exit(0);         }    }    // Fill mask    data = malloc(NLongitude * NLatitude * sizeof(*data));    if(data == NULL){        fprintf(stderr, "Could not malloc");        exit(0);     }    if ((retval = nc_inq_varid(ncid, "mask", &varid)))        ERR(retval);    if((retval = nc_get_var_float(ncid, varid, data)))        ERR(retval);    for (k = 0; k < NLatitude; k++) {        for (j = 0; j < NLongitude; j++) {            Mask[j][k] = data[k * NLongitude + j];        }    }    free(data);        // close file    if ((retval = nc_close(ncid)))       ERR(retval);        // Allocate Grids    Grid = malloc(NLongitude * sizeof(*Grid));    if(Grid == NULL){        fprintf(stderr, "Could not malloc");        exit(0);     }    for (j = 0; j < NLongitude; j++) {        Grid[j] = malloc(NLatitude * sizeof(*Grid[j]));        if(Grid[j] == NULL){            fprintf(stderr, "Could not malloc");            exit(0);         }    }        // Add AngstA, AngstB & Altitude    AngstA = malloc(NLongitude * sizeof(*AngstA));    AngstB = malloc(NLongitude * sizeof(*AngstB));    Altitude = malloc(NLongitude * sizeof(*Altitude));    if(AngstA == NULL || AngstB == NULL || Altitude == NULL){        fprintf(stderr, "Could not malloc");        exit(0);     }    for (j = 0; j < NLongitude; j++) {        AngstA[j] = malloc(NLatitude * sizeof(*AngstA[j]));        AngstB[j] = malloc(NLatitude * sizeof(*AngstB[j]));        Altitude[j] = malloc(NLatitude * sizeof(*Altitude[j]));        if(AngstA[j] == NULL || AngstB[j] == NULL || Altitude[j] == NULL){            fprintf(stderr, "Could not malloc");            exit(0);         }        for (k = 0; k < NLatitude; k++) {            if (Mask[j][k] == 1) {                AngstA[j][k] = 0.4885 - 0.0052 * Latitude[k];                AngstB[j][k] =  0.1563 + 0.0074 * Longitude[k];                // TODO: temporary needs to be fixed                Altitude[j][k] = 100;            } else {                AngstA[j][k] = -99;                AngstB[j][k] = -99;                // TODO: temporary needs to be fixed                Altitude[j][k] = -99;            }        }    }}