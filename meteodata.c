#include <stdio.h>#include <string.h>#include <stdlib.h>#include <limits.h>#include <math.h>#include <time.h>#include "wofost.h"int GetMeteoData(char* path, char* dateString, char* station, int *Day){  int c, i, j, day;  int year, month;  int end;  int sim_day;  float A, B, Rad;  char file_1[100];  char file_2[100];  char dummy[100];  char str_year[5];  char str_rest[5];  char str_i[1];  time_t rawTime;    FILE *fq;  struct tm * parsedTime;     if(sscanf(dateString, "%d-%d-%d", &year, &month, &day) != EOF){     time(&rawTime);    parsedTime = localtime(&rawTime);    // tm_year is years since 1900    parsedTime->tm_year = year - 1900;        // tm_months is months since january    parsedTime->tm_mon = month - 1;    parsedTime->tm_mday = day;   }    if (year < 9999)  {    sprintf(str_year,"%d",year);    strcpy(file_1, path);    strcat(file_1,station);        j = year / 1000;    sprintf(str_i,"%d",j);    strcat(file_1, str_i);    strcat(file_1,".");    strcpy(file_2,file_1);        sprintf(str_rest,"%3d", year - 1000 * j);    strcat(file_1, str_rest);        sprintf(str_rest,"%3d", year - 999 * j);    strcat(file_2, str_rest);      }  else      return 0;      /* open first year */    if ((fq = fopen(file_1, "rt")) == NULL)        {fprintf(stderr, "Cannot open input file.\n"); return 0;}    /* skip lines in the header */     while ((c=fgetc(fq)) == '*')         while ((c=fgetc(fq)) != '\n');    fscanf(fq,"%f %f %f %f %f", &Longitude, &Latitude, &Altitude,  &A, &B);    Site.AngstA = fabs(A);    Site.AngstB = fabs(B);        /* skip lines */    if (*Day > 1)    {        for (i=1;i<*Day;i++)        {            fscanf(fq,"%98s", &dummy);        }    }        end = leap_year(year);    for (i=*Day;i<=end;i++)    {            /* Set first index to 1 i.e. day of the simulation */        sim_day = i - *Day  +1;        fscanf(fq,"%d %d %d %f %f %f %f %f %f", &Station, &Year, &day, &Rad,                                          &Tmin[i - *Day  +1],                                           &Tmax[i - *Day + 1],                                           &Vapour[i - *Day + 1],                                          &Windspeed[i - *Day + 1],                                            &Rain[i - *Day + 1]);		        /* Transform Radiation from KJ m-2 d-1 to J m-2 d-1 */        Radiation[i - *Day + 1] = 1000.*Rad;    }    fclose(*fq);    if (*Day > 1)    {   /* open second year */        if ((fq = fopen(file_2, "rt")) == NULL)            {fprintf(stderr, "Cannot open input file.\n"); return 0;}        /* skip lines in the header */         while ((c=fgetc(fq)) == '*')             while ((c=fgetc(fq)) != '\n');            for (i = 1; i<=*Day; i++)            {                fscanf(fq,"%d %d %d %f %f %f %f %f %f", &Station, &Year, &day, &Rad,                                          &Tmin[end - *Day  + i],                                           &Tmax[end - *Day + i],                                           &Vapour[end - *Day + i],                                          &Windspeed[end - *Day + i],                                           &Rain[end - *Day + i]);                /* Transform Radiation from KJ m-2 d-1 to J m-2 d-1 */                Radiation[end - *Day + i] = 1000.*Rad;            }    }                 return 1;}